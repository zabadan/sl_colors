<<<<<<< HEAD
'use strict';

var hexTable = (function () {
    var array = new Array(256);
    for (var i = 0; i < 256; ++i) {
        array[i] = '%' + ((i < 16 ? '0' : '') + i.toString(16)).toUpperCase();
    }

    return array;
}());

exports.arrayToObject = function (source, options) {
    var obj = options.plainObjects ? Object.create(null) : {};
    for (var i = 0; i < source.length; ++i) {
        if (typeof source[i] !== 'undefined') {
=======
// Load modules


// Declare internals

var internals = {};
internals.hexTable = new Array(256);
for (var h = 0; h < 256; ++h) {
    internals.hexTable[h] = '%' + ((h < 16 ? '0' : '') + h.toString(16)).toUpperCase();
}


exports.arrayToObject = function (source, options) {

    var obj = options.plainObjects ? Object.create(null) : {};
    for (var i = 0, il = source.length; i < il; ++i) {
        if (typeof source[i] !== 'undefined') {

>>>>>>> 60c0efd51e9c4271a396c74cb37c9681801184ab
            obj[i] = source[i];
        }
    }

    return obj;
};

<<<<<<< HEAD
exports.merge = function (target, source, options) {
=======

exports.merge = function (target, source, options) {

>>>>>>> 60c0efd51e9c4271a396c74cb37c9681801184ab
    if (!source) {
        return target;
    }

    if (typeof source !== 'object') {
        if (Array.isArray(target)) {
            target.push(source);
<<<<<<< HEAD
        } else if (typeof target === 'object') {
            target[source] = true;
        } else {
            return [target, source];
=======
        }
        else if (typeof target === 'object') {
            target[source] = true;
        }
        else {
            target = [target, source];
>>>>>>> 60c0efd51e9c4271a396c74cb37c9681801184ab
        }

        return target;
    }

    if (typeof target !== 'object') {
<<<<<<< HEAD
        return [target].concat(source);
    }

    var mergeTarget = target;
    if (Array.isArray(target) && !Array.isArray(source)) {
        mergeTarget = exports.arrayToObject(target, options);
    }

	return Object.keys(source).reduce(function (acc, key) {
        var value = source[key];

        if (Object.prototype.hasOwnProperty.call(acc, key)) {
            acc[key] = exports.merge(acc[key], value, options);
        } else {
            acc[key] = value;
        }
		return acc;
    }, mergeTarget);
};

exports.decode = function (str) {
=======
        target = [target].concat(source);
        return target;
    }

    if (Array.isArray(target) &&
        !Array.isArray(source)) {

        target = exports.arrayToObject(target, options);
    }

    var keys = Object.keys(source);
    for (var k = 0, kl = keys.length; k < kl; ++k) {
        var key = keys[k];
        var value = source[key];

        if (!Object.prototype.hasOwnProperty.call(target, key)) {
            target[key] = value;
        }
        else {
            target[key] = exports.merge(target[key], value, options);
        }
    }

    return target;
};


exports.decode = function (str) {

>>>>>>> 60c0efd51e9c4271a396c74cb37c9681801184ab
    try {
        return decodeURIComponent(str.replace(/\+/g, ' '));
    } catch (e) {
        return str;
    }
};

exports.encode = function (str) {
<<<<<<< HEAD
=======

>>>>>>> 60c0efd51e9c4271a396c74cb37c9681801184ab
    // This code was originally written by Brian White (mscdex) for the io.js core querystring library.
    // It has been adapted here for stricter adherence to RFC 3986
    if (str.length === 0) {
        return str;
    }

<<<<<<< HEAD
    var string = typeof str === 'string' ? str : String(str);

    var out = '';
    for (var i = 0; i < string.length; ++i) {
        var c = string.charCodeAt(i);

        if (
            c === 0x2D || // -
=======
    if (typeof str !== 'string') {
        str = '' + str;
    }

    var out = '';
    for (var i = 0, il = str.length; i < il; ++i) {
        var c = str.charCodeAt(i);

        if (c === 0x2D || // -
>>>>>>> 60c0efd51e9c4271a396c74cb37c9681801184ab
            c === 0x2E || // .
            c === 0x5F || // _
            c === 0x7E || // ~
            (c >= 0x30 && c <= 0x39) || // 0-9
            (c >= 0x41 && c <= 0x5A) || // a-z
<<<<<<< HEAD
            (c >= 0x61 && c <= 0x7A) // A-Z
        ) {
            out += string.charAt(i);
=======
            (c >= 0x61 && c <= 0x7A)) { // A-Z

            out += str[i];
>>>>>>> 60c0efd51e9c4271a396c74cb37c9681801184ab
            continue;
        }

        if (c < 0x80) {
<<<<<<< HEAD
            out = out + hexTable[c];
=======
            out += internals.hexTable[c];
>>>>>>> 60c0efd51e9c4271a396c74cb37c9681801184ab
            continue;
        }

        if (c < 0x800) {
<<<<<<< HEAD
            out = out + (hexTable[0xC0 | (c >> 6)] + hexTable[0x80 | (c & 0x3F)]);
=======
            out += internals.hexTable[0xC0 | (c >> 6)] + internals.hexTable[0x80 | (c & 0x3F)];
>>>>>>> 60c0efd51e9c4271a396c74cb37c9681801184ab
            continue;
        }

        if (c < 0xD800 || c >= 0xE000) {
<<<<<<< HEAD
            out = out + (hexTable[0xE0 | (c >> 12)] + hexTable[0x80 | ((c >> 6) & 0x3F)] + hexTable[0x80 | (c & 0x3F)]);
            continue;
        }

        i += 1;
        c = 0x10000 + (((c & 0x3FF) << 10) | (string.charCodeAt(i) & 0x3FF));
        out += (hexTable[0xF0 | (c >> 18)] + hexTable[0x80 | ((c >> 12) & 0x3F)] + hexTable[0x80 | ((c >> 6) & 0x3F)] + hexTable[0x80 | (c & 0x3F)]);
=======
            out += internals.hexTable[0xE0 | (c >> 12)] + internals.hexTable[0x80 | ((c >> 6) & 0x3F)] + internals.hexTable[0x80 | (c & 0x3F)];
            continue;
        }

        ++i;
        c = 0x10000 + (((c & 0x3FF) << 10) | (str.charCodeAt(i) & 0x3FF));
        out += internals.hexTable[0xF0 | (c >> 18)] + internals.hexTable[0x80 | ((c >> 12) & 0x3F)] + internals.hexTable[0x80 | ((c >> 6) & 0x3F)] + internals.hexTable[0x80 | (c & 0x3F)];
>>>>>>> 60c0efd51e9c4271a396c74cb37c9681801184ab
    }

    return out;
};

<<<<<<< HEAD
exports.compact = function (obj, references) {
    if (typeof obj !== 'object' || obj === null) {
        return obj;
    }

    var refs = references || [];
=======
exports.compact = function (obj, refs) {

    if (typeof obj !== 'object' ||
        obj === null) {

        return obj;
    }

    refs = refs || [];
>>>>>>> 60c0efd51e9c4271a396c74cb37c9681801184ab
    var lookup = refs.indexOf(obj);
    if (lookup !== -1) {
        return refs[lookup];
    }

    refs.push(obj);

    if (Array.isArray(obj)) {
        var compacted = [];

<<<<<<< HEAD
        for (var i = 0; i < obj.length; ++i) {
=======
        for (var i = 0, il = obj.length; i < il; ++i) {
>>>>>>> 60c0efd51e9c4271a396c74cb37c9681801184ab
            if (typeof obj[i] !== 'undefined') {
                compacted.push(obj[i]);
            }
        }

        return compacted;
    }

    var keys = Object.keys(obj);
<<<<<<< HEAD
    for (var j = 0; j < keys.length; ++j) {
        var key = keys[j];
=======
    for (i = 0, il = keys.length; i < il; ++i) {
        var key = keys[i];
>>>>>>> 60c0efd51e9c4271a396c74cb37c9681801184ab
        obj[key] = exports.compact(obj[key], refs);
    }

    return obj;
};

<<<<<<< HEAD
exports.isRegExp = function (obj) {
    return Object.prototype.toString.call(obj) === '[object RegExp]';
};

exports.isBuffer = function (obj) {
    if (obj === null || typeof obj === 'undefined') {
        return false;
    }

    return !!(obj.constructor && obj.constructor.isBuffer && obj.constructor.isBuffer(obj));
=======

exports.isRegExp = function (obj) {

    return Object.prototype.toString.call(obj) === '[object RegExp]';
};


exports.isBuffer = function (obj) {

    if (obj === null ||
        typeof obj === 'undefined') {

        return false;
    }

    return !!(obj.constructor &&
              obj.constructor.isBuffer &&
              obj.constructor.isBuffer(obj));
>>>>>>> 60c0efd51e9c4271a396c74cb37c9681801184ab
};
